# Database Schema Changes

## New Tables

### `alert_web_push_destination`

Stores Web Push API subscription details associated with a specific alert.

| Column | Type | Constraints | Description |
| :--- | :--- | :--- | :--- |
| `id` | `INTEGER` | `PRIMARY KEY AUTOINCREMENT` | Unique ID |
| `alert_id` | `INTEGER` | `FOREIGN KEY REFERENCES alert(id) ON DELETE CASCADE` | The alert this subscription belongs to |
| `endpoint` | `TEXT` | `NOT NULL` | The unique URL generated by the push service |
| `p256dh` | `TEXT` | `NOT NULL` | User's public encryption key (Base64 encoded) |
| `auth` | `TEXT` | `NOT NULL` | User's authentication secret (Base64 encoded) |
| `created_at` | `TIMESTAMP` | `DEFAULT CURRENT_TIMESTAMP` | |

### `alert_webhook_destination`

Stores generic Webhook URLs for an alert.

| Column | Type | Constraints | Description |
| :--- | :--- | :--- | :--- |
| `id` | `INTEGER` | `PRIMARY KEY AUTOINCREMENT` | Unique ID |
| `alert_id` | `INTEGER` | `FOREIGN KEY REFERENCES alert(id) ON DELETE CASCADE` | The alert this webhook belongs to |
| `url` | `TEXT` | `NOT NULL` | The URL to POST the alert payload to |
| `secret` | `TEXT` | `NULLABLE` | Optional secret for signing the payload (HMAC) |
| `created_at` | `TIMESTAMP` | `DEFAULT CURRENT_TIMESTAMP` | |

## Migration Plan

1.  Run `sea-orm-cli migrate generate create_alert_destinations`.
2.  Implement the `up` and `down` methods in the generated migration file using the schema defined above.
3.  Run the migration.
4.  Run `generate_entities.sh` to update Rust structs.
